<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
  <title>Company Portal – Competitor Promotion Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-bg: #FDF8F3;
      --color-surface: #FFFBF7;
      --color-header: #6B4E3D;
      --color-text-primary: #6B4E3D;
      --color-text-secondary: #A67C5A;
      --color-border: #E8D5C4;
      --color-accent: #E67E22;
      --color-comp-1: #D2691E;
      --color-comp-2: #CD853F;
      --color-comp-3: #8B4513;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text-primary);
    }
    .paper-card {
      background-color: var(--color-surface);
      border-radius: 16px;
      border: 1px solid var(--color-border);
      padding: 24px;
      transition: transform .3s, box-shadow .3s;
      box-shadow: 0 8px 32px rgba(107,78,61,.1);
      opacity: 0; animation: fadeIn .5s ease-out forwards;
    }
    .paper-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 32px rgba(107,78,61,.15);
    }
    .notification {
      transform: translateX(100%);
      transition: transform .3s;
      position: fixed; top: 1rem; right: 1rem; z-index: 50;
    }
    .notification.show { transform: translateX(0); }

    /* Timeline */
    .timeline-full-row { display: flex; align-items: stretch; border-bottom:1px solid var(--color-border); min-height:44px; }
    .timeline-sticky-label {
      flex:0 0 200px; padding:8px 12px; font-size:13px; font-weight:500; background:#fcfaf8;
      border-right:1px solid var(--color-border); position:sticky; left:0; z-index:10;
      display:flex; align-items:center;
    }
    .timeline-header-row { position:sticky; top:0; z-index:20; background:var(--color-header); color:white; }
    .timeline-header-day {
      flex:1 1 0; padding:8px 4px; text-align:center; font-size:11px; font-weight:600;
      border-right:1px solid #8a6f5e; display:flex; align-items:center; justify-content:center;
    }
    .timeline-header-day.today { background:var(--color-accent); animation:pulse 2s infinite; }
    .timeline-header-day.weekend { background:#806251; }
    .timeline-bar {
      position:absolute; height:28px; top:50%; transform:translateY(-50%);
      border-radius:4px; display:flex; align-items:center; font-size:11px; font-weight:600;
      color:white; cursor:pointer; padding:0 8px; overflow:hidden; white-space:nowrap;
      text-overflow:ellipsis; transition:all .2s;
    }
    .timeline-bar:hover { transform:translateY(-50%) scaleY(1.1); box-shadow:0 4px 8px rgba(0,0,0,.2); }
    /* Colors */
    .timeline-bar.hartono { background-color:var(--color-comp-1)!important; }
    .timeline-bar.electronic-city { background-color:var(--color-comp-2)!important; }
    .timeline-bar.erablue { background-color:var(--color-comp-3)!important; }
    .timeline-bar.courts { background-color:var(--color-comp-1)!important; }
    .timeline-bar.harvey-norman { background-color:var(--color-comp-2)!important; }
    .timeline-bar.gain-city { background-color:var(--color-comp-3)!important; }
    .timeline-bar.senheng { background-color:var(--color-comp-1)!important; }

    /* Promo Cards */
    .promo-card-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; }
    .promo-card-header { padding:1rem; font-size:1.25rem; font-weight:700; color:white; }
    .promo-card-header.hartono { background:var(--color-comp-1)!important; }
    .promo-card-header.electronic-city { background:var(--color-comp-2)!important; }
    .promo-card-header.erablue { background:var(--color-comp-3)!important; }
    .promo-card-header.courts { background:var(--color-comp-1)!important; }
    .promo-card-header.harvey-norman { background:var(--color-comp-2)!important; }
    .promo-card-header.gain-city { background:var(--color-comp-3)!important; }
    .promo-card-header.senheng { background:var(--color-comp-1)!important; }

    /* Country Tabs with Flags */
    .country-tab { position:relative; padding-left:1.8rem; }
    .country-tab::before {
      content:''; position:absolute; left:.2rem; top:50%; transform:translateY(-50%);
      width:18px; height:12px; border-radius:2px; background-size:cover;
    }
    .country-tab[data-country="Indonesia"]::before {
      background:linear-gradient(to bottom,#ff0000 50%,#ffffff 50%);
    }
    .country-tab[data-country="Singapore"]::before {
      background:linear-gradient(to bottom,#ef4136 50%,#ffffff 50%);
    }
    .country-tab[data-country="Malaysia"]::before {
      background:linear-gradient(90deg,#003893 25%,#ffffff 25% 50%,#cc0001 50%);
    }

    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)} }
    @keyframes pulse {0%,100%{transform:scale(1);box-shadow:0 0 0 0 rgba(230,126,34,.7)}50%{transform:scale(1.05);box-shadow:0 0 0 10px rgba(230,126,34,0)}}
  </style>
</head>
<body>
  <div id="notification" class="notification text-white px-4 py-2 rounded-lg shadow-lg"><span id="notification-text"></span></div>
  <div class="flex flex-col min-h-screen p-4 md:p-8">
    <header class="paper-card flex flex-col md:flex-row items-center justify-between p-4 mb-6">
      <div class="flex items-center mb-4 md:mb-0">
        <svg class="h-8 w-8 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 208"><path fill="#A1112C" d="…"/></svg>
        <h2 class="text-xl font-bold" style="color:var(--color-header)">Competitor Tracker</h2>
      </div>
      <nav class="flex flex-col md:flex-row gap-2">
        <a href="#" class="country-tab" data-country="Indonesia">Indonesia</a>
        <a href="#" class="country-tab" data-country="Singapore">Singapore</a>
        <a href="#" class="country-tab" data-country="Malaysia">Malaysia</a>
      </nav>
    </header>
    <main class="flex-1">
      <div class="flex flex-col md:flex-row justify-between items-start mb-8 gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold" style="color:var(--color-header)">Competitive Promotions</h1>
          <p class="text-sm" style="color:var(--color-text-secondary)">Real-time August 2025 offers</p>
          <p id="last-updated-text" class="text-xs text-gray-500 mt-1"></p>
        </div>
      </div>
      <!-- Timeline -->
      <div class="paper-card mb-8 hidden lg:block">
        <div class="flex justify-between items-center mb-4">
          <h3 id="timeline-title" class="text-lg font-semibold" style="color:var(--color-header)"></h3>
          <div class="flex gap-2">
            <button id="prev-month-btn" class="px-3 py-2 bg-gray-200 rounded-md">&lt; Prev</button>
            <button id="next-month-btn" class="px-3 py-2 bg-gray-200 rounded-md">Next &gt;</button>
          </div>
        </div>
        <div id="timeline-wrapper" class="border rounded-lg overflow-x-auto"></div>
      </div>
      <div class="paper-card mb-8 lg:hidden text-center text-gray-600">Detailed timeline view available on desktop.</div>
      <!-- Dashboard -->
      <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4" style="color:var(--color-header)">Dashboard & Reporting</h2>
        <div class="grid grid-cols-1 gap-8">
          <div class="paper-card p-6">
            <h3 class="font-semibold mb-4" style="color:var(--color-header)">Active Promotions per Competitor</h3>
            <canvas id="bar-chart" style="min-height:250px"></canvas>
          </div>
          <div id="doughnut-charts-container" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
        </div>
      </div>
      <!-- Promo Cards -->
      <div class="mb-8">
        <h2 class="text-2xl font-bold mb-4" style="color:var(--color-header)">Current Promotions Overview</h2>
        <div id="promo-cards-container" class="promo-card-grid"></div>
      </div>
    </main>
  </div>

  <!-- Modals omitted for brevity; keep original modal HTML -->

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const JSONBIN_URL = 'https://api.jsonbin.io/v3/b/68904e27f7e7a370d1f349bb';
    const JSONBIN_API_KEY = '$…';

    let promotions = [];
    let currentDate = new Date('2025-08-05T00:00:00Z');
    let charts = {};
    let activeCountry = 'Indonesia';

    const countryData = {
      'Indonesia': {
        competitors:['Hartono','Electronic City','Erablue'],
        config:{
          'Hartono':{colorClass:'hartono',chartColor:var('--color-comp-1')},
          'Electronic City':{colorClass:'electronic-city',chartColor:var('--color-comp-2')},
          'Erablue':{colorClass:'erablue',chartColor:var('--color-comp-3')}
        }
      },
      'Singapore':{
        competitors:['COURTS','Harvey Norman','Gain City'],
        config:{
          'COURTS':{colorClass:'courts',chartColor:var('--color-comp-1')},
          'Harvey Norman':{colorClass:'harvey-norman',chartColor:var('--color-comp-2')},
          'Gain City':{colorClass:'gain-city',chartColor:var('--color-comp-3')}
        }
      },
      'Malaysia':{
        competitors:['Senheng','Harvey Norman','COURTS'],
        config:{
          'Senheng':{colorClass:'senheng',chartColor:var('--color-comp-1')},
          'Harvey Norman':{colorClass:'harvey-norman',chartColor:var('--color-comp-2')},
          'COURTS':{colorClass:'courts',chartColor:var('--color-comp-3')}
        }
      }
    };

    const promoCategories = ['Promo Bank & Payment','Promo HP & Gadget','Promo Laptop & PC','Promo TV & Audio','Promo Home Appliances','Other Promotions'];

    // Real August 2025 promotions
    const samplePromotions = [
      // Singapore – COURTS
      {competitor:"COURTS",title:"KINGKOIL Mattress",startDate:"2025-08-01",endDate:"2025-08-31",details:"S$2,742 – 54% off",category:"Promo Home Appliances",country:"Singapore"},
      {competitor:"COURTS",title:"OPPO Find N5 5G",startDate:"2025-08-01",endDate:"2025-08-31",details:"S$2,299 – 8% off",category:"Promo HP & Gadget",country:"Singapore"},
      // Singapore – Harvey Norman
      {competitor:"Harvey Norman",title:"Climate Vouchers up to $700 off",startDate:"2025-08-01",endDate:"2025-08-31",details:"Select appliances",category:"Promo Home Appliances",country:"Singapore"},
      {competitor:"Harvey Norman",title:"Grab PayLater – Save $60",startDate:"2025-08-01",endDate:"2025-08-31",details:"Min $1,500 spend",category:"Promo Bank & Payment",country:"Singapore"},
      // Singapore – Gain City
      {competitor:"Gain City",title:"SG60 $6 off every $60",startDate:"2025-07-21",endDate:"2025-08-10",details:"Online only",category:"Other Promotions",country:"Singapore"},
      // Malaysia – Senheng
      {competitor:"Senheng",title:"Grand Opening Sri Petaling",startDate:"2025-08-08",endDate:"2025-08-11",details:"50% S-Coin cashback",category:"Other Promotions",country:"Malaysia"},
      // Malaysia – Harvey Norman
      {competitor:"Harvey Norman",title:"Merdeka SALEbration up to 70% off",startDate:"2025-08-14",endDate:"2025-09-03",details:"Home & IT",category:"Other Promotions",country:"Malaysia"},
      // Malaysia – COURTS
      {competitor:"COURTS",title:"NSK Kota Damansara Grand Opening",startDate:"2025-08-03",endDate:"2025-08-21",details:"RM99 AC install",category:"Other Promotions",country:"Malaysia"},
      // Indonesia – Hartono
      {competitor:"Hartono",title:"Samsung Fridge Independence Promo",startDate:"2025-08-01",endDate:"2025-08-31",details:"Two-door fridge deals",category:"Promo Home Appliances",country:"Indonesia"},
      // Indonesia – Electronic City
      {competitor:"Electronic City",title:"Mid Night Sale up to IDR1,000,000 off",startDate:"2025-08-24",endDate:"2025-08-31",details:"BCA card discounts",category:"Promo TV & Audio",country:"Indonesia"},
      // Indonesia – Erablue
      {competitor:"Erablue",title:"Grand Opening Agus Salim Bekasi",startDate:"2025-08-11",endDate:"2025-08-15",details:"Store-exclusive deals",category:"Other Promotions",country:"Indonesia"}
    ];

    function populatePromoTypeDropdowns() {
      setTimeout(() => {
        ['competitor','promoType'].forEach(id => {
          const sel = document.getElementById(id);
          if (!sel) return;
          sel.innerHTML = '<option value="">Select...</option>';
          const items = id==='competitor' ? countryData[activeCountry].competitors : promoCategories;
          items.forEach(i => sel.appendChild(Object.assign(document.createElement('option'),{value:i,textContent:i})));
        });
      },50);
    }

    function setupTabs() {
      const tabs = document.getElementById('country-tabs');
      tabs.innerHTML='';
      Object.keys(countryData).forEach(country=>{
        const a=document.createElement('a');
        a.href='#'; a.textContent=country; a.className='country-tab'; a.dataset.country=country;
        if(country===activeCountry) a.style.color=var('--color-accent');
        a.onclick=e=>{e.preventDefault();activeCountry=country;setupTabs();populatePromoTypeDropdowns();rerenderAll();};
        tabs.appendChild(a);
      });
    }

    function rerenderAll(){
      const monthStart=new Date(Date.UTC(currentDate.getUTCFullYear(),currentDate.getUTCMonth(),1));
      const monthEnd=new Date(Date.UTC(currentDate.getUTCFullYear(),currentDate.getUTCMonth()+1,0,23,59,59));
      const activePromos=promotions.filter(p=>{
        const s=new Date(p.startDate+'T00:00:00Z'), e=new Date(p.endDate+'T00:00:00Z'), today=new Date();
        return (((s<=monthEnd&&e>=monthStart)||(s<=today&&e>=today))&&p.country===activeCountry);
      });
      createTimeline(activePromos);
      renderPromotionCards(activePromos);
      renderDashboard(activePromos);
      updateLastUpdatedText();
    }

    function createTimeline(activePromos){}
    function renderPromotionCards(activePromos){}
    function renderDashboard(activePromos){
      Object.values(charts).forEach(c=>c.destroy());
      const ctx=document.getElementById('bar-chart').getContext('2d');
      const comps=countryData[activeCountry].competitors;
      charts.bar=new Chart(ctx,{
        type:'bar',
        data:{labels:comps,datasets:[{
          data:comps.map(c=>activePromos.filter(p=>p.competitor===c).length),
          backgroundColor:comps.map(c=>countryData[activeCountry].config[c].chartColor),
          borderRadius:4
        }]},
        options:{indexAxis:'y',plugins:{legend:{display:false}}}
      });
    }
    function showNotification(msg,cls='bg-green-500'){
      const n=document.getElementById('notification');
      n.textContent=msg; n.className=`notification text-white px-4 py-2 rounded-lg shadow-lg ${cls} show`;
      setTimeout(()=>n.classList.remove('show'),3000);
    }
    function updateLastUpdatedText(){
      document.getElementById('last-updated-text').textContent=`Last updated: ${new Date().toLocaleString()}`;
    }

    // Initialize
    setupTabs();
    promotions=samplePromotions;
    populatePromoTypeDropdowns();
    document.getElementById('openAddPromoModalBtn').onclick=()=>{
      populatePromoTypeDropdowns();
      document.getElementById('addPromoModal').classList.remove('hidden');
    };
    rerenderAll();
  });
  </script>
</body>
</html>
