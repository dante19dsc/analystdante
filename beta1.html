<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Portal - Competitor Promotion Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Yuji+Boku&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #F0F2F5; /* Softer background */
            background-image: radial-gradient(#E0E2E5 1px, transparent 1px);
            background-size: 16px 16px;
        }
        .paper-card {
            background-color: #FFFFFF;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* Stronger shadow */
            border: 1px solid #e2e8f0; /* Subtle border */
        }
        .font-scribble { font-family: 'Yuji Boku', serif; }
        .notification {
            transform: translateX(100%);
            transition: transform 0.4s ease-out; /* Smoother animation */
            position: fixed; top: 1.5rem; right: 1.5rem; z-index: 50;
            opacity: 0; /* Start hidden */
        }
        .notification.show { 
            transform: translateX(0); 
            opacity: 1; /* Fade in */
        }

        /* Timeline Specific Styles */
        .timeline-container {
            overflow-x: auto;
            background: #FFFFFF;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            padding-bottom: 10px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.03); /* Inner shadow */
        }
        .timeline-header, .timeline-row {
            display: grid;
            grid-template-columns: 200px repeat(31, 30px);
            grid-auto-columns: 30px; /* Explicitly set width for auto-generated columns */
            width: max-content; /* Ensures content takes full width, enabling scroll */
            min-height: 40px;
        }
        .timeline-header {
            position: sticky; top: 0; 
            z-index: 20; /* Increased z-index */
            background-color: #4F46E5; /* Deeper purple */
            color: white;
            border-top-left-radius: 0.75rem; /* Match container border-radius */
            border-top-right-radius: 0.75rem;
            overflow: hidden; /* For rounded corners on sticky header */
        }
        .timeline-header-cell {
            padding: 10px 4px; /* Slightly more padding */
            text-align: center;
            font-size: 12px; /* Slightly larger font */
            font-weight: 700; /* Bolder */
            border-right: 1px solid #6D68EC; /* Lighter border for contrast */
            box-shadow: inset -1px 0 0 rgba(255,255,255,0.1); /* Subtle inner shadow */
        }
        .timeline-header-cell:first-child { 
            position: sticky; left: 0; 
            z-index: 21; /* Increased z-index to be above other header cells */
            background-color: #4F46E5; /* Match header background */
            border-right: 1px solid #6D68EC;
        }
        .timeline-header-cell.today { background-color: #EF4444; } /* Red for today */
        .timeline-header-cell.independence-day { background-color: #DC2626; } /* Darker red for holiday */
        
        .timeline-row {
            border-bottom: 1px solid #f3f4f6;
        }
        .timeline-row:last-child {
            border-bottom: none; /* No border on last row */
        }
        .timeline-label {
            padding: 8px 12px; font-size: 13px; font-weight: 500;
            color: #374151; border-right: 1px solid #e5e7eb;
            background-color: #f9fafb; position: sticky; left: 0;
            z-index: 15; /* Increased z-index to be above normal content */
            display: flex; align-items: center;
        }
        .timeline-label.competitor-header { 
            font-weight: 700; font-size: 14px; 
            background-color: #EEF2FF; /* Lighter blue for competitor header */
            color: #4338CA; /* Darker blue text */
        }
        .timeline-cell { 
            border-right: 1px solid #f3f4f6; 
            position: relative; 
            transition: background-color 0.1s ease-in-out; /* Smooth transition */
        }
        .timeline-cell:hover {
            background-color: #f0f4f8 !important; /* Lighter hover effect */
        }
        .timeline-bar {
            position: absolute; height: 28px; top: 6px; left: 2px;
            border-radius: 6px; /* Slightly more rounded */
            display: flex; align-items: center;
            font-size: 10px; /* Smaller font for bars */
            font-weight: 600; color: white;
            cursor: pointer; 
            transition: all 0.2s ease; z-index: 6;
            padding: 0 6px; /* Less padding */
            overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow on bars */
        }
        .timeline-bar:hover { 
            transform: translateY(-2px) scale(1.02); /* Lift and grow slightly */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25); /* More pronounced shadow on hover */
        }
        /* Gradient colors for bars */
        .timeline-bar.hartono { background: linear-gradient(135deg, #FACC15, #D97706); } /* Yellow-Orange */
        .timeline-bar.electronic-city { background: linear-gradient(135deg, #3B82F6, #1D4ED8); } /* Blue */
        .timeline-bar.erablue { background: linear-gradient(135deg, #10B981, #059669); } /* Green */

        /* Styles for the new promotion cards */
        .promo-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Slightly wider min width */
            gap: 2rem; /* More space between cards */
        }
        .promo-card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .promo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 20px -5px rgb(0 0 0 / 0.15), 0 6px 8px -6px rgb(0 0 0 / 0.15);
        }
        .promo-card-header {
            padding: 1.25rem; /* More padding */
            font-size: 1.35rem; /* Larger font */
            font-weight: 700;
            color: #374151;
            background-color: #F3F4F6; /* Lighter background */
            border-bottom: 1px solid #E5E7EB;
        }
        .promo-card-content {
            padding: 1.5rem; /* More padding */
        }
        .promo-item {
            margin-bottom: 1.5rem; /* More space between items */
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed #E5E7EB; /* Clearer separator */
        }
        .promo-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .promo-item-link { 
            display: flex;
            align-items: flex-start;
            text-decoration: none; 
            color: inherit; 
            cursor: pointer;
            transition: all 0.2s ease; /* Smooth transition for entire link area */
        }
        .promo-item-link:hover {
            transform: translateX(5px); /* Slight slide on hover */
        }
        .promo-item-link:hover .promo-item-title {
            color: #4F46E5; /* Highlight title with primary color on hover */
        }
        .promo-item-img {
            width: 90px; /* Slightly larger image */
            height: 90px;
            border-radius: 0.65rem; /* More rounded */
            object-fit: cover;
            margin-right: 1.25rem; /* More margin */
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Subtle shadow on image */
        }
        .promo-item-details {
            flex-grow: 1;
        }
        .promo-item-title {
            font-weight: 700; /* Bolder title */
            color: #1F2937;
            margin-bottom: 0.4rem; /* More space */
            transition: color 0.2s ease; 
        }
        .promo-item-category {
            font-size: 0.8rem; /* Slightly larger category text */
            color: #6B7280;
            margin-bottom: 0.6rem; /* More space */
            padding: 0.3rem 0.6rem; /* More padding */
            background-color: #E0E7FF; /* Lighter background for category tag */
            border-radius: 0.35rem; /* More rounded */
            display: inline-block;
            font-weight: 500;
        }
        .promo-item-description {
            font-size: 0.9rem; /* Slightly larger description */
            color: #4B5563;
            line-height: 1.5; /* Better readability */
            margin-top: 0.5rem; /* More space */
        }
        .promo-item-dates {
            font-size: 0.75rem;
            color: #6B7280;
            margin-top: 0.75rem; /* More space */
            font-weight: 500;
        }

        /* General Button Styling */
        button {
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        .bg-red-600 { background-color: #EF4444; } /* Brighter red */
        .hover\:bg-red-700:hover { background-color: #DC2626; } /* Darker red on hover */
    </style>
</head>
<body class="text-gray-800">

    <div id="notification" class="bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg notification">
        <span id="notification-text">Notification message</span>
    </div>

    <div class="flex flex-col min-h-screen p-4 md:p-8">
        <!-- Header -->
        <header class="paper-card flex items-center justify-between p-4 w-full mb-8">
            <div class="flex items-center">
                <svg class="h-9 w-9 mr-3" viewBox="0 0 240 208" xmlns="http://www.w3.org/2000/svg"><path fill="#A1112C" d="M148.2,148.1c-9.3,12.4-26.2,18.6-43.1,18.6c-12.4,0-24.8-4.1-34.2-12.4c-13.4-11.4-20.7-28.8-18.6-46.3c-14.5-7.2-22.8-22.8-20.7-39.4c2.1-16.6,15.5-29.8,32.1-32.9c5.2-20.7,23.8-35.2,45.5-35.2c24.8,0,45.5,18.6,48.6,43.1c16.6,3.1,28.8,16.5,29.8,33.1C251.2,125.4,225.7,117.2,211.2,124.5z"/><path fill="#D61A3B" d="M211.2,124.5c-9.3,12.4-26.2,18.6-43.1,18.6c-12.4,0-24.8-4.1-34.2-12.4c-13.4-11.4-20.7-28.8-18.6-46.3c-14.5-7.2-22.8-22.8-20.7-39.4c2.1-16.6,15.5-29.8,32.1-32.9c5.2-20.7,23.8-35.2,45.5-35.2c24.8,0,45.5,18.6,48.6,43.1c16.6,3.1,28.8,16.5,29.8,33.1C251.2,125.4,225.7,117.2,211.2,124.5z"/></svg>
                <h2 class="text-2xl font-bold text-gray-900 font-scribble">あれなんだっけ</h2>
            </div>
            <nav class="flex items-center gap-3 md:gap-5">
                <button class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-800">Marketing Info</button>
                <button class="px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-800">Store Map</button>
                <button class="px-4 py-2 text-sm font-medium rounded-lg bg-indigo-50 text-indigo-700 shadow-sm">Promotion Tracker</button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10">
                <div>
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">Competitor Promotion Tracker</h1>
                    <p class="text-gray-600 text-lg">Monitor and analyze competitor promotional activities in real-time</p>
                </div>
                <button class="mt-6 md:mt-0 inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-lg text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add New Promotion
                </button>
            </div>
            
            <div class="paper-card p-6 mb-10">
                <h3 class="text-xl font-semibold text-gray-900 mb-5">August 2025 - Detailed Promotions by Competitor</h3>
                <div class="timeline-container">
                    <div id="timeline-grid">
                        <!-- JS will build the timeline here -->
                    </div>
                </div>
            </div>

            <!-- New Section: Competitor Promotion Cards -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">Current Promotions Overview</h2>
                <div id="promo-cards-container" class="promo-card-grid">
                    <!-- Promotion cards will be rendered here by JS -->
                </div>
            </div>
        </main>
    </div>

    <!-- Custom Modal for Promotion Details -->
    <div id="promoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 transform transition-all scale-95 opacity-0" id="modal-dialog">
            <h4 class="text-xl font-bold mb-4 text-gray-900">Promotion Details</h4>
            <p id="modal-content" class="text-gray-700 whitespace-pre-wrap leading-relaxed"></p>
            <button class="mt-8 px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 float-right" onclick="hideModal()">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- COMPETITOR CONFIGURATION ---
            const competitorConfig = {
                'Hartono': { colorClass: 'hartono', bgColor: '#FEFCE8', websiteUrl: 'https://myhartono.com/en/promo-pilihan' },
                'Electronic City': { colorClass: 'electronic-city', bgColor: '#EFF6FF', websiteUrl: 'https://eci.id/' },
                'Erablue': { colorClass: 'erablue', bgColor: '#F0FDFA', websiteUrl: 'https://www.erablue.id/' }
            };

            // --- UTILITY FUNCTIONS ---
            const getPromoCategory = (promo) => {
                const text = (promo.title + ' ' + promo.details).toLowerCase();
                if (text.includes('bank') || text.includes('credit card') || text.includes('cicilan') || text.includes('dbs') || text.includes('mandiri') || text.includes('kredivo') || text.includes('indodana')) return 'Promo Bank & Payment';
                if (text.includes('hp') || text.includes('smartphone') || text.includes('galaxy') || text.includes('foldable') || text.includes('reno') || text.includes('vivo') || text.includes('realme') || text.includes('wearables')) return 'Promo HP & Gadget';
                if (text.includes('laptop') || text.includes('vivobook') || text.includes('acer') || text.includes('lenovo') || text.includes('hp') || text.includes('asus') || text.includes('pc') || text.includes('snapdragon')) return 'Promo Laptop & PC';
                if (text.includes('tv') || text.includes('soundbar') || text.includes('qled') || text.includes('uhd') || text.includes('google tv') || text.includes('smart tv') || text.includes('speaker')) return 'Promo TV & Audio';
                if (text.includes('refrigerator') || text.includes('kulkas') || text.includes('mesin cuci') || text.includes('washing machine') || text.includes('water heater') || text.includes('air cooler') || text.includes('setrika')) return 'Promo Home Appliances';
                if (text.includes('back to school') || text.includes('kembali ke sekolah')) return 'Promo Back to School';
                if (text.includes('independence day') || text.includes('kemerdekaan') || text.includes('17 agustus')) return 'Promo 17 Agustus';
                return 'Other Promotions'; // Catch-all for new categories
            };

            const getCategoryImageUrl = (category, competitorColorClass) => {
                let text = '';
                let bgColor = '';
                switch (category) {
                    case 'Promo Bank & Payment': text = 'Bank'; bgColor = '60A5FA'; break;
                    case 'Promo HP & Gadget': text = 'Phone'; bgColor = '2DD4BF'; break;
                    case 'Promo Laptop & PC': text = 'Laptop'; bgColor = 'FBBF24'; break;
                    case 'Promo TV & Audio': text = 'TV'; bgColor = '60A5FA'; break;
                    case 'Promo Home Appliances': text = 'Appliance'; bgColor = '2DD4BF'; break;
                    case 'Promo Back to School': text = 'School'; bgColor = 'FBBF24'; break;
                    case 'Promo 17 Agustus': text = 'Flag'; bgColor = 'EF4444'; break;
                    default: text = 'Promo'; bgColor = 'D1D5DB'; break;
                }
                // Use competitor's primary color for image background if available
                if (competitorColorClass === 'hartono') bgColor = 'F59E0B';
                else if (competitorColorClass === 'electronic-city') bgColor = '2563EB';
                else if (competitorColorClass === 'erablue') bgColor = '0D9488';

                return `https://placehold.co/100x100/${bgColor}/ffffff?text=${encodeURIComponent(text)}`;
            };

            // --- UPDATED & REALISTIC PROMOTION DATA (Dates set for AUG 2025) ---
            const promotions = [
                // Source: MyHartono.com/en/promo-pilihan (Checked on July 31, 2025)
                { competitor: 'Hartono', title: 'Sony Days – Upgrade TV Tanpa Biaya Kirim!', startDate: '2025-07-04', endDate: '2025-08-03', details: 'Free shipping for TV upgrades.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Philips Personal Care Discount up to 30%', startDate: '2025-07-04', endDate: '2025-08-04', details: 'Up to 30% discount on Philips personal care products.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Kredivo Belanja Sekarang, Bayar Nanti', startDate: '2025-07-28', endDate: '2025-08-31', details: 'Buy now, pay later with Kredivo.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Indodana PayLater Belanja Online Lebih Enteng', startDate: '2025-07-01', endDate: '2025-08-31', details: 'Easier online shopping with Indodana PayLater.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Samsung Premium AI TV Exclusive Package', startDate: '2025-07-14', endDate: '2025-08-31', details: 'Exclusive package for Samsung Premium AI TVs.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Power UP dengan Snapdragon PC', startDate: '2025-06-23', endDate: '2025-09-30', details: 'Promotion for Snapdragon-powered PCs.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Acer Day 2025: Garansi Ekstra!', startDate: '2025-07-08', endDate: '2025-09-30', details: 'Extra warranty for Acer products during Acer Day 2025.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Ariston Water Heater Gratis Pemasangan', startDate: '2025-06-01', endDate: '2025-09-30', details: 'Free installation for Ariston water heaters.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Samsung Wearables Mulai 400 Ribuan!', startDate: '2025-06-25', endDate: '2025-08-16', details: 'Samsung Galaxy wearables starting from IDR 400,000.', promoUrl: 'https://myhartono.com/en/promo-pilihan' },

                // Source: Eci.id (Electronic City - Checked on July 31, 2025)
                { competitor: 'Electronic City', title: 'AC Free Installation & Pipe (Mitsubishi)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Free installation, pipe, and bracket for select Mitsubishi AC units.', promoUrl: 'https://eci.id/' },
                { competitor: 'Electronic City', title: 'Flash Sale: SHARP Refrigerator Multidoor', startDate: '2025-08-01', endDate: '2025-08-31', details: 'SHARP Refrigerator Multidoor SJ-IF51PG-BK/BL at Rp. 8.999.000 (23% off).', promoUrl: 'https://eci.id/' },
                { competitor: 'Electronic City', title: 'Flash Sale: SONY Soundbar Speaker HT-S400', startDate: '2025-08-01', endDate: '2025-08-31', details: 'SONY Soundbar Speaker HT-S400 at Rp. 2.499.000 (29% off).', promoUrl: 'https://eci.id/' },
                { competitor: 'Electronic City', title: 'Gebyar Brand Festival: TCL QLED Google TV 55 Inch', startDate: '2025-08-01', endDate: '2025-08-31', details: 'TCL QLED Google TV 55P7K at Rp. 6.999.000 (28% off).', promoUrl: 'https://eci.id/' },
                { competitor: 'Electronic City', title: 'LG UHD Smart TV 50 Inch Discount', startDate: '2025-08-01', endDate: '2025-08-31', details: 'LG UHD Smart TV 50UA7550PSA at Rp. 5.199.000 (30% off).', promoUrl: 'https://eci.id/' },

                // Source: Erablue.id (Checked on July 31, 2025)
                { competitor: 'Erablue', title: 'OPPO Reno14 Series 5G Launch Promo', startDate: '2025-07-25', endDate: '2025-08-31', details: 'Launch promotion for OPPO Reno14 Series 5G with AI photography features and millions in rupiah in promos.', promoUrl: 'https://www.erablue.id/' },
                { competitor: 'Erablue', title: 'Smartphone Discounts (Oppo, Vivo, Realme)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Various smartphone models with discounts (e.g., Oppo Reno12 5G 12GB/512GB SILVER at Rp 4.999.000).', promoUrl: 'https://www.erablue.id/' },
                { competitor: 'Erablue', title: 'TV Discounts (Toshiba, Samsung, Sharp, TCL)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts on various TV models (e.g., Google TV Toshiba 4K 75 Inch 75M550NP at Rp 14.999.000).', promoUrl: 'https://www.erablue.id/' },
                { competitor: 'Erablue', title: 'Laptop Discounts (Acer, Lenovo, HP, Asus)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts on various laptop models (e.g., Laptop Acer Aspire Lite 15 Intel Core i5-12450H/8GB/512GB/M365/Win11 (AL15-71P-51VG) Silver at Rp 8.399.000).', promoUrl: 'https://www.erablue.id/' },
                { competitor: 'Erablue', title: 'Kulkas Discounts (LG, Aqua, Electrolux)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts on various refrigerator models (e.g., Kulkas 2 Pintu LG Inverter 363L GN-B389FLDM at Rp 7.615.000).', promoUrl: 'https://www.erablue.id/' },
                { competitor: 'Erablue', title: 'Mesin Cuci Discounts (Samsung, Polytron, TCL)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts on various washing machine models (e.g., Mesin Cuci Front Loading Samsung Inverter 14 kg WW14T504DAB/SE at Rp 9.999.000).', promoUrl: 'https://www.erablue.id/' }
            ];

            // Add category and image URL to each promotion object
            promotions.forEach(promo => {
                promo.category = getPromoCategory(promo);
                const config = competitorConfig[promo.competitor];
                promo.imageUrl = getCategoryImageUrl(promo.category, config.colorClass);
            });

            const calculatePromotionSpan = (startDate, endDate) => {
                const augustStart = new Date('2025-08-01T00:00:00Z');
                const augustEnd = new Date('2025-08-31T23:59:59Z');
                let promoStart = new Date(startDate), promoEnd = new Date(endDate);
                
                // Clamp promo dates to August
                promoStart = promoStart < augustStart ? augustStart : promoStart;
                promoEnd = promoEnd > augustEnd ? augustEnd : promoEnd;

                if (promoStart > promoEnd) {
                    return { startDay: -1, duration: 0 }; // Promotion is outside August
                }
                
                // Calculate start day relative to August 1st (1-indexed)
                const startDay = promoStart.getUTCDate();
                const duration = promoEnd.getUTCDate() - startDay + 1;
                return { startDay, duration };
            };
            
            // --- CORE RENDERING FUNCTION FOR TIMELINE ---
            const createTimeline = () => {
                const container = document.getElementById('timeline-grid');
                if (!container) return;
                container.innerHTML = ''; // Clear previous content

                const competitors = ['Hartono', 'Electronic City', 'Erablue'];
                const categories = [...new Set(promotions.map(p => p.category))].sort();
                
                // Create header row
                const header = document.createElement('div');
                header.className = 'timeline-header';
                let headerHTML = '<div class="timeline-header-cell">AUGUST 2025</div>';
                const today = new Date();
                const currentDayOfMonth = today.getDate();
                const currentMonth = today.getMonth(); // 0-indexed
                const currentYear = today.getFullYear();

                for (let day = 1; day <= 31; day++) {
                    let specialClass = '';
                    if (day === currentDayOfMonth && currentMonth === 7 && currentYear === 2025) { 
                        specialClass = 'today';
                    } else if (day === 17) {
                        specialClass = 'independence-day';
                    }
                    headerHTML += `<div class="timeline-header-cell ${specialClass}">${day}</div>`;
                }
                header.innerHTML = headerHTML;
                container.appendChild(header);

                // Create rows for each competitor and their categories
                competitors.forEach(compName => {
                    const config = competitorConfig[compName];
                    
                    const competitorRow = document.createElement('div');
                    competitorRow.className = 'timeline-row';
                    const competitorLabel = document.createElement('div');
                    competitorLabel.className = 'timeline-label competitor-header';
                    competitorLabel.textContent = compName;
                    competitorRow.appendChild(competitorLabel);

                    for (let i = 0; i < 31; i++) {
                        const cell = document.createElement('div');
                        cell.className = 'timeline-cell';
                        cell.style.backgroundColor = config.bgColor;
                        competitorRow.appendChild(cell);
                    }
                    container.appendChild(competitorRow);

                    categories.forEach(catName => {
                        const categoryRow = document.createElement('div');
                        categoryRow.className = 'timeline-row';
                        
                        const categoryLabel = document.createElement('div');
                        categoryLabel.className = 'timeline-label';
                        categoryLabel.textContent = catName;
                        categoryRow.appendChild(categoryLabel);
                        
                        const dayCells = [];
                        for (let i = 0; i < 31; i++) {
                            const cell = document.createElement('div');
                            cell.className = 'timeline-cell';
                            cell.style.backgroundColor = config.bgColor;
                            dayCells.push(cell);
                            categoryRow.appendChild(cell);
                        }

                        promotions
                            .filter(p => p.competitor === compName && p.category === catName)
                            .forEach(promo => {
                                const span = calculatePromotionSpan(promo.startDate, promo.endDate);
                                if (span.duration > 0) {
                                    const bar = document.createElement('div');
                                    bar.className = `timeline-bar ${config.colorClass}`;
                                    bar.style.width = `${(span.duration * 30) - 4}px`;
                                    bar.textContent = promo.title;
                                    bar.title = `[${promo.category}] ${promo.title}\n\nDetails: ${promo.details}\nDuration: ${promo.startDate} to ${promo.endDate}`;
                                    bar.onclick = () => showModal(bar.title);
                                    
                                    if (dayCells[span.startDay - 1]) {
                                        dayCells[span.startDay - 1].appendChild(bar);
                                    }
                                }
                            });
                        container.appendChild(categoryRow);
                    });
                });
            };

            // --- RENDER PROMOTION CARDS ---
            const renderPromotionCards = () => {
                const container = document.getElementById('promo-cards-container');
                if (!container) return;
                container.innerHTML = '';

                const competitors = ['Hartono', 'Electronic City', 'Erablue'];

                competitors.forEach(compName => {
                    const compPromotions = promotions.filter(p => p.competitor === compName);
                    if (compPromotions.length === 0) return;

                    const card = document.createElement('div');
                    card.className = 'promo-card';
                    card.innerHTML = `
                        <div class="promo-card-header">${compName} Promotions</div>
                        <div class="promo-card-content" id="promo-content-${compName.replace(/\s/g, '')}">
                            <!-- Promotions will be appended here -->
                        </div>
                    `;
                    container.appendChild(card);

                    const contentDiv = document.getElementById(`promo-content-${compName.replace(/\s/g, '')}`);
                    compPromotions.forEach(promo => {
                        const promoItem = document.createElement('div'); // This div now wraps the entire clickable area and description
                        promoItem.className = 'promo-item';

                        // Create the clickable link part
                        const linkElement = document.createElement('a');
                        linkElement.href = promo.promoUrl;
                        linkElement.target = '_blank';
                        linkElement.rel = 'noopener noreferrer';
                        linkElement.className = 'promo-item-link';

                        linkElement.innerHTML = `
                            <img src="${promo.imageUrl}" alt="${promo.category}" class="promo-item-img">
                            <div class="promo-item-details">
                                <div class="promo-item-title">${promo.title}</div>
                                <div class="promo-item-category">${promo.category}</div>
                            </div>
                        `;
                        promoItem.appendChild(linkElement);

                        // Add description and dates outside the main clickable link but inside promo-item
                        const descriptionParagraph = document.createElement('p');
                        descriptionParagraph.className = 'promo-item-description';
                        descriptionParagraph.textContent = promo.details;
                        promoItem.appendChild(descriptionParagraph);

                        const datesParagraph = document.createElement('p');
                        datesParagraph.className = 'promo-item-dates';
                        datesParagraph.textContent = `${promo.startDate} - ${promo.endDate}`;
                        promoItem.appendChild(datesParagraph);

                        contentDiv.appendChild(promoItem);
                    });
                });
            };

            // --- CUSTOM MODAL FOR PROMOTION DETAILS (Replaces alert()) ---
            const showModal = (message) => {
                const modal = document.getElementById('promoModal');
                const modalDialog = document.getElementById('modal-dialog');
                document.getElementById('modal-content').textContent = message;
                modal.classList.remove('hidden');
                // Trigger reflow to ensure transition plays
                void modalDialog.offsetWidth; 
                modalDialog.classList.remove('scale-95', 'opacity-0');
                modalDialog.classList.add('scale-100', 'opacity-100');
            };

            const hideModal = () => {
                const modal = document.getElementById('promoModal');
                const modalDialog = document.getElementById('modal-dialog');
                modalDialog.classList.remove('scale-100', 'opacity-100');
                modalDialog.classList.add('scale-95', 'opacity-0');
                modal.addEventListener('transitionend', function handler() {
                    modal.classList.add('hidden');
                    modal.removeEventListener('transitionend', handler);
                });
            };

            // --- INITIALIZE ---
            createTimeline();
            renderPromotionCards();
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            notificationText.textContent = '✅ Timeline and promotion cards loaded!';
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 4000);
        });
    </script>
</body>
</html>
