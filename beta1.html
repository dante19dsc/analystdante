<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Portal - Competitor Promotion Tracker</title>
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Yuji+Boku&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; background-color: #F8F7F4; background-image: radial-gradient(#D9D9D9 1px, transparent 1px); background-size: 16px 16px; }
        .paper-card { background-color: #FFFFFF; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); }
        .font-scribble { font-family: 'Yuji Boku', serif; }
        .notification { transform: translateX(100%); transition: transform 0.3s ease-in-out; position: fixed; top: 1rem; right: 1rem; z-index: 50; }
        .notification.show { transform: translateX(0); }
        .timeline-container { display: flex; background: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; padding-bottom: 10px; }
        .timeline-fixed-col { flex-shrink: 0; width: 200px; background-color: #f9fafb; border-right: 1px solid #e5e7eb; z-index: 10; }
        .timeline-scroll-wrapper { flex-grow: 1; overflow-x: auto; }
        .timeline-header { display: grid; grid-template-columns: repeat(31, 30px); position: sticky; top: 0; z-index: 10; background-color: #6366f1; }
        .timeline-header-label { padding: 8px 4px; text-align: center; font-size: 11px; font-weight: 600; color: white; background-color: #6366f1; border-right: 1px solid #7c7ee8; height: 41px; display: flex; align-items: center; justify-content: center; }
        .timeline-header-label.today { background-color: #ef4444; animation: pulse 2s infinite; }
        .timeline-header-label.weekend { background-color: #4f46e5; }
        .timeline-row { display: grid; grid-template-columns: repeat(31, 30px); min-height: 40px; border-bottom: 1px solid #f3f4f6; position: relative; }
        .timeline-label { padding: 8px 12px; font-size: 13px; font-weight: 500; color: #374151; background-color: #f9fafb; display: flex; align-items: center; border-bottom: 1px solid #f3f4f6; min-height: 40px; }
        .timeline-label.competitor-header { font-weight: 700; font-size: 14px; background-color: #eef2ff; }
        .timeline-bar { position: absolute; height: 28px; top: 6px; border-radius: 4px; display: flex; align-items: center; font-size: 11px; font-weight: 600; color: white; cursor: pointer; transition: all 0.2s ease, width 0.5s ease-out; padding: 0 8px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; width: 0; }
        .timeline-bar:hover { transform: scaleY(1.1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
        .timeline-bar.hartono { background: linear-gradient(135deg, #FBBF24, #F59E0B); }
        .timeline-bar.electronic-city { background: linear-gradient(135deg, #60A5FA, #2563EB); }
        .timeline-bar.erablue { background: linear-gradient(135deg, #2DD4BF, #0D9488); }
        .promo-card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .promo-card { background-color: #FFFFFF; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); overflow: hidden; display: flex; flex-direction: column; transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-out forwards; }
        .promo-card:hover { transform: translateY(-8px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .promo-card-header { padding: 1rem; font-size: 1.25rem; font-weight: 700; color: white; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .promo-card-header.hartono { background: linear-gradient(135deg, #FBBF24, #F59E0B); }
        .promo-card-header.electronic-city { background: linear-gradient(135deg, #60A5FA, #2563EB); }
        .promo-card-header.erablue { background: linear-gradient(135deg, #2DD4BF, #0D9488); }
        .promo-card-content { padding: 1rem; flex-grow: 1; }
        .promo-item { display: flex; align-items: flex-start; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px dashed #e5e7eb; position: relative; animation: fadeIn 0.5s ease-out forwards; }
        .promo-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .promo-item-icon-container { width: 80px; height: 80px; border-radius: 0.5rem; margin-right: 1rem; flex-shrink: 0; padding: 12px; border: 1px solid #e5e7eb; background-color: #f9fafb; display: flex; align-items: center; justify-content: center; transition: transform 0.2s ease-in-out; }
        .promo-item-icon-container:hover { transform: scale(1.1); }
        .promo-item-icon-container svg { width: 100%; height: 100%; }
        .promo-item-details { flex-grow: 1; }
        .promo-item-title { font-weight: 600; color: #1f2937; margin-bottom: 0.25rem; }
        .promo-item-category { font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem; padding: 0.25rem 0.5rem; background-color: #eef2ff; border-radius: 0.25rem; display: inline-block; }
        .promo-item-description { font-size: 0.875rem; color: #4b5563; }
        .promo-item-actions { position: absolute; top: 0; right: 0; display: flex; gap: 0.25rem; }
        .promo-item-actions button { background: none; border: none; color: #9ca3af; cursor: pointer; padding: 0.25rem; }
        .promo-item-actions button:hover { color: #3b82f6; }
        .promo-item-actions .delete-promo-btn:hover { color: #ef4444; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }
        .modal { display: none; }
        .modal.is-open { display: flex; }
    </style>
</head>
<body class="text-gray-800">

    <div id="notification" class="bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg notification"><span id="notification-text"></span></div>

    <div class="flex flex-col min-h-screen p-4 md:p-8">
        <header class="paper-card flex flex-col md:flex-row items-center justify-between p-4 w-full mb-6">
            <div class="flex items-center mb-4 md:mb-0">
                <svg class="h-8 w-8 mr-2" viewBox="0 0 240 208" xmlns="http://www.w3.org/2000/svg"><path fill="#A1112C" d="M148.2,148.1c-9.3,12.4-26.2,18.6-43.1,18.6c-12.4,0-24.8-4.1-34.2-12.4c-13.4-11.4-20.7-28.8-18.6-46.3c-14.5-7.2-22.8-22.8-20.7-39.4c2.1-16.6,15.5-29.8,32.1-32.9c5.2-20.7,23.8-35.2,45.5-35.2c24.8,0,45.5,18.6,48.6,43.1c16.6,3.1,28.8,16.5,29.8,33.1c1,16.6-7.2,32.1-21.7,40.4C167.8,124.5,160.5,138.8,148.2,148.1z"/><path fill="#D61A3B" d="M211.2,124.5c-9.3,12.4-26.2,18.6-43.1,18.6c-12.4,0-24.8-4.1-34.2-12.4c-13.4-11.4-20.7-28.8-18.6-46.3c-14.5-7.2-22.8-22.8-20.7-39.4c2.1-16.6,15.5-29.8,32.1-32.9c5.2-20.7,23.8-35.2,45.5-35.2c24.8,0,45.5,18.6,48.6,43.1c16.6,3.1,28.8,16.5,29.8,33.1C251.2,125.4,225.7,117.2,211.2,124.5z"/></svg>
                <h2 class="text-xl font-bold text-gray-900 font-scribble">あれなんだっけ</h2>
            </div>
            <nav class="flex flex-col md:flex-row items-center gap-2 md:gap-4">
                <a href="https://dante19dsc.github.io/analystdante/" target="_blank" rel="noopener noreferrer" class="px-3 py-2 text-sm font-medium rounded-lg text-gray-500 hover:bg-gray-100 w-full md:w-auto text-center">Marketing Information</a>
                <button class="px-3 py-2 text-sm font-medium rounded-lg text-gray-500 hover:bg-gray-100 w-full md:w-auto">Store Development Map</button>
                <button class="px-3 py-2 text-sm font-medium rounded-lg bg-gray-100 text-gray-900 w-full md:w-auto">Promotion Tracker</button>
            </nav>
        </header>

        <main class="flex-1 p-4 md:p-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Competitor Promotion Tracker</h1>
                    <p class="text-gray-600 mt-2">Monitor and analyze competitor promotional activities in real-time</p>
                    <p id="last-updated-text" class="text-xs text-gray-500 mt-1"></p>
                </div>
                <div class="flex gap-2">
                    <button id="openAddPromoModalBtn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                        <i class="fa-solid fa-plus mr-2"></i> Add Promotion
                    </button>
                </div>
            </div>
            
            <div class="paper-card p-6 mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">August 2025 - Detailed Promotions by Competitor</h3>
                <div class="timeline-container flex">
                    <div id="timeline-labels" class="timeline-fixed-col"></div>
                    <div id="timeline-content-scroll" class="timeline-scroll-wrapper"></div>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Current Promotions Overview</h2>
                <div id="promo-cards-container" class="promo-card-grid"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="promoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 items-center justify-center z-50 modal">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            <h4 class="text-lg font-bold mb-4">Promotion Details</h4>
            <p id="modal-content" class="text-gray-700 whitespace-pre-wrap"></p>
            <div id="modal-actions" class="mt-6 flex justify-end gap-2"></div>
        </div>
    </div>
    <div id="deleteConfirmModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 items-center justify-center z-50 modal">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            <h4 class="text-lg font-bold mb-2">Confirm Deletion</h4>
            <p class="text-gray-700 mb-6">Are you sure you want to delete this promotion?</p>
            <div class="flex justify-end gap-2">
                <button id="cancelDeleteBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
                <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Yes, Delete</button>
            </div>
        </div>
    </div>
    <div id="addPromoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 items-center justify-center z-50 modal">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-lg font-bold">Add New Promotion</h4>
                <button id="closeAddModalBtn" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form id="addPromoForm" class="space-y-4 mb-4">
                <div><label for="competitor" class="block text-sm font-medium text-gray-700">Competitor</label><select id="competitor" name="competitor" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="">Select a Competitor</option><option value="Hartono">Hartono</option><option value="Electronic City">Electronic City</option><option value="Erablue">Erablue</option></select></div>
                <div><label for="promoType" class="block text-sm font-medium text-gray-700">Promotion Type</label><select id="promoType" name="promoType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="">Select a Category</option></select></div>
                <div><label for="title" class="block text-sm font-medium text-gray-700">Promotion Title</label><input type="text" id="title" name="title" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                <div><label for="promoUrl" class="block text-sm font-medium text-gray-700">Promotion URL</label><input type="url" id="promoUrl" name="promoUrl" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="https://example.com/promo"></div>
                <div class="flex gap-4">
                    <div class="flex-1"><label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label><input type="date" id="startDate" name="startDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                    <div class="flex-1"><label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label><input type="date" id="endDate" name="endDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                </div>
                <div><label for="details" class="block text-sm font-medium text-gray-700">Details</label><textarea id="details" name="details" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700">Add Promotion</button>
            </form>
        </div>
    </div>
    <div id="editPromoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 items-center justify-center z-50 modal">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-lg font-bold">Edit Promotion</h4>
                <button id="closeEditModalBtn" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form id="editPromoForm" class="space-y-4">
                <input type="hidden" id="editPromoId">
                <div><label for="editCompetitor" class="block text-sm font-medium text-gray-700">Competitor</label><select id="editCompetitor" name="competitor" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="Hartono">Hartono</option><option value="Electronic City">Electronic City</option><option value="Erablue">Erablue</option></select></div>
                <div><label for="editPromoType" class="block text-sm font-medium text-gray-700">Promotion Type</label><select id="editPromoType" name="promoType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></select></div>
                <div><label for="editTitle" class="block text-sm font-medium text-gray-700">Promotion Title</label><input type="text" id="editTitle" name="title" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                <div><label for="editPromoUrl" class="block text-sm font-medium text-gray-700">Promotion URL</label><input type="url" id="editPromoUrl" name="promoUrl" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="https://example.com/promo"></div>
                <div class="flex gap-4">
                    <div class="flex-1"><label for="editStartDate" class="block text-sm font-medium text-gray-700">Start Date</label><input type="date" id="editStartDate" name="startDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                    <div class="flex-1"><label for="editEndDate" class="block text-sm font-medium text-gray-700">End Date</label><input type="date" id="editEndDate" name="endDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                </div>
                <div><label for="editDetails" class="block text-sm font-medium text-gray-700">Details</label><textarea id="editDetails" name="details" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const SUPABASE_URL = 'https://mohswbdebacxysyomyoy.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vaHN3YmRlYmFjeHlzeW9teW95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNzc1MjEsImV4cCI6MjA2OTg1MzUyMX0.2sgVgMidw6wT2IAroRaFw-WQS5FPnC47fY-vtWR7LRI';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase client initialized.');

            let promotions = [];
            const originalPromotionsData = [
                { competitor: 'Hartono', title: 'Free Shipping Nationwide', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Use code: FREEONGKIRMH. Discounts based on purchase value. Valid for online purchases.', url: 'https://myhartono.com/en/promo-pilihan' },
                { competitor: 'Hartono', title: 'Samsung Galaxy Wearables Special Price', startDate: '2025-06-25', endDate: '2025-08-16', details: 'Starting from Rp400,000. Limited stock availability.', url: 'https://myhartono.com/en/samsung-galaxy-wearable-special-price/' },
                { competitor: 'Hartono', title: 'BCA Credit Card Promotion', startDate: '2025-08-01', endDate: '2025-08-31', details: '0% installment for 6 and 12 months. Valid for online transactions.', url: 'https://myhartono.com/en/bca/' },
                { competitor: 'Hartono', title: 'Trade-In TV & AC Program', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Trade-in values up to Rp1,500,000. Professional pickup service. Max 7 days to request trade-in.', url: 'https://myhartono.com/en/trade-in-tv-and-ac-hartono' },
                { competitor: 'Hartono', title: '"Hadiah Sahabat Setia 2025" Loyalty Program', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Ongoing loyalty program with car giveaway opportunities.', url: 'https://www.instagram.com/myhartono/' },
                { competitor: 'Electronic City', title: 'BCA Credit Card Discount up to Rp1,000,000', startDate: '2025-07-31', endDate: '2025-08-10', details: 'Discount tiers from Rp200,000 to Rp1,000,000. Valid at Electronic Festival Exhibition at Supermal Karawaci.', url: 'https://promo.bca.co.id/en/all/2025/07/31/04/electronic-city' },
                { competitor: 'Electronic City', title: 'HUAWEI MatePad Pro 12.2 2025 Discount', startDate: '2025-07-25', endDate: '2025-08-31', details: 'Rp500,000 discount on HUAWEI MatePad Pro.', url: 'https://promo.bca.co.id/en/all/2025/06/25/09/electronic-city' },
                { competitor: 'Electronic City', title: 'OPPO Products Discount', startDate: '2025-07-25', endDate: '2025-09-30', details: 'Rp350,000 discount on various OPPO products.', url: 'https://promo.bca.co.id/id/all/2025/06/10/05/electronic-city' },
                { competitor: 'Electronic City', title: 'PAHLAWAN (PROMO HEMAT TIADA LAWAN)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Independence month promotion.', url: 'https://eci.id' },
                { competitor: 'Electronic City', title: 'DAIKIN Air Conditioner "IRIT KIAN NYAMAN"', startDate: '2025-08-01', endDate: '2025-08-31', details: 'August discount promotion on Daikin ACs.', url: 'https://eci.id/deal/1416/daikin-diskon-agustus-irit-kian-nyaman' },
                { competitor: 'Electronic City', title: 'LG August Special Offer', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Brand-specific August promotions on LG products.', url: 'https://eci.id' },
                { competitor: 'Electronic City', title: 'SCBD Store Clearance Sale', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Extra savings up to 50% at Electronic City SCBD.', url: 'https://www.instagram.com/p/DMzmbD8Rj2u/' },
                { competitor: 'Electronic City', title: 'Mandiri Credit Card Discount', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts up to Rp500,000 and installments up to 12 months.', url: 'https://www.mandirikartukredit.com/hot-offer?kategori=elektronik' },
                { competitor: 'Erablue', title: 'Samsung Galaxy S25 Edge Special Pricing', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Rp17,499,000 (10% discount from Rp19,499,000).', url: 'https://eraspace.com/page/mantra' },
                { competitor: 'Erablue', title: 'Tecno Camon 20 Premier 5G Special Pricing', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Rp3,999,000 (27% discount).', url: 'https://eraspace.com/page/mantra' },
                { competitor: 'Erablue', title: 'Back to School Promotion', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Educational technology focus.', url: 'https://eraspace.com/eraspace/katalog/back-to-school-7719' },
                { competitor: 'Erablue', title: 'OPPO Reno14 Series Promotion', startDate: '2025-07-25', endDate: '2025-08-31', details: 'Special pricing on new mobile phone releases.', url: 'https://erafone.com/katalog/first-selling-oppo-reno14-series-7746' },
                { competitor: 'Erablue', title: 'OPPO Contest Promotion (August 2025)', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Win prizes like Umrah vouchers and mobile phones when you purchase select OPPO phones.', url: 'https://www.erablue.id/promosi/beli-handphone-gratis-umroh-hanya-di-erablue-electronics-1582259' },
                { competitor: 'Erablue', title: 'Sharp Electronics Special Pricing', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts starting from Rp200,000 on Sharp products.', url: 'https://www.erablue.id/promosi/super-brand-day-sharp-di-erablue-bikin-agustus-makin-meriah-1582258' },
                { competitor: 'Erablue', title: 'Mandiri Credit Card Programs', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Discounts up to Rp1,000,000 with 0% interest on installments.', url: 'https://www.mandirikartukredit.com/hot-offer?kategori=elektronik%2Bhome-appliances' },
                { competitor: 'Erablue', title: 'Audio Festival', startDate: '2025-08-01', endDate: '2025-08-31', details: 'Promotions on sound equipment and accessories.', url: 'https://eraspace.com/urbanrepublic/katalog/audio-festival-2238' },
            ];

            async function addBulkPromotions() {
                const { count, error: countError } = await supabaseClient.from('promotions').select('*', { count: 'exact', head: true });
                if (countError) {
                    console.error("Error checking table count:", countError);
                    return;
                }
                if (count > 0) {
                    console.log('Database already populated.');
                    return; 
                }
                console.log('Populating database with initial data...');
                const { error } = await supabaseClient.from('promotions').insert(originalPromotionsData);
                if (error) {
                    console.error('Bulk insert failed:', error);
                } else {
                    console.log('Bulk insert successful.');
                    await loadPromotions(); // Load the data after inserting
                }
            }

            async function loadPromotions() {
                const { data, error } = await supabaseClient.from('promotions').select('*');
                if (error) { 
                    showNotification('❌ Error loading data.', 'bg-red-500'); 
                } else {
                    promotions = data;
                    promotions.forEach(promo => {
                        promo.category = getPromoCategory(promo);
                        promo.iconHTML = getCategoryIcon(promo.category);
                    });
                    rerenderAll();
                }
            }

            const competitorConfig = { 'Hartono': { colorClass: 'hartono', bgColor: '#FEFCE8' }, 'Electronic City': { colorClass: 'electronic-city', bgColor: '#EFF6FF' }, 'Erablue': { colorClass: 'erablue', bgColor: '#F0FDFA' } };
            const categoryIcons = { 'Promo Bank & Payment': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="10" y="25" width="80" height="50" rx="8" fill="#005A9C"/><rect x="10" y="60" width="80" height="5" fill="#7BB8F2"/><rect x="22" y="35" width="15" height="12"rx="2" fill="#F5A623"/></svg>`, 'Promo HP & Gadget': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="35" y="15" width="50" height="70" rx="8" fill="#7BB8F2"/><rect x="15" y="25" width="40" height="60" rx="8" fill="#005A9C"/><rect x="20" y="32" width="30" height="46" rx="3" fill="#F5A623"/></svg>`, 'Promo Laptop & PC': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g><path d="M 5 70 L 95 70 L 85 78 L 15 78 Z" fill="#005A9C"/><rect x="18" y="22" width="74" height="48" rx="5" fill="#7BB8F2" transform="skewX(-10)"/><rect x="25" y="28" width="60" height="36" rx="2" fill="#005A9C" transform="skewX(-10)"/></g></svg>`, 'Promo TV & Audio': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="8" y="20" width="84" height="50" rx="4" fill="#005A9C"/><rect x="13" y="25" width="74" height="40" fill="#7BB8F2"/><path d="M 45 70 L 55 70 L 65 80 L 35 80 Z" fill="#005A9C"/><rect x="20" y="85" width="60" height="5" rx="2.5" fill="#F5A623"/></svg>`, 'Promo Home Appliances': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g transform="translate(50 35) scale(0.8)"><path d="M 0 -15 L 0 15 M -13 0 L 13 0 M -9 -9 L 9 9 M -9 9 L 9 -9" stroke="#005A9C" stroke-width="4" stroke-linecap="round"/></g><path d="M 25 60 C 25 50, 50 50, 50 75 S 75 90, 75 80 C 75 70, 60 70, 50 85 Z" fill="#7BB8F2" transform="translate(-15 0)"/><g transform="translate(70 70) scale(0.6)"><circle cx="0" cy="0" r="12" fill="none" stroke="#F5A623" stroke-width="4"/><path d="M 0 0 L 10 5" stroke="#F5A623" stroke-width="4" stroke-linecap="round"/><path d="M 0 0 L -10 5" stroke="#F5A623" stroke-width="4" stroke-linecap="round"/><path d="M 0 0 L 0 -12" stroke="#F5A623" stroke-width="4" stroke-linecap="round"/></g></svg>`, 'Promo Back to School': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 15 80 Q 50 90 85 80 L 85 20 Q 50 10 15 20 Z" fill="#005A9C"/><path d="M 50 22 V 82" stroke="#7BB8F2" stroke-width="4"/><circle cx="50" cy="50" r="12" fill="#F5A623"/><path d="M 50 38 Q 55 35 52 30" stroke="#005A9C" stroke-width="3" fill="none"/></svg>`, 'Promo 17 Agustus': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="15" y="10" width="6" height="80" rx="3" fill="#005A9C"/><path d="M 21 25 C 40 15, 60 35, 80 25 V 45 C 60 55, 40 35, 21 45 Z" fill="#F5A623"/><path d="M 21 45 C 40 35, 60 55, 80 45 V 65 C 60 75, 40 55, 21 65 Z" fill="#7BB8F2"/></svg>`, 'Other Promotions': `<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="20" y="40" width="60" height="45" rx="5" fill="#005A9C"/><rect x="15" y="25" width="70" height="15" rx="5" fill="#7BB8F2"/><rect x="45" y="25" width="10" height="60" fill="#F5A623"/><path d="M 45 25 C 35 15, 25 15, 25 25" stroke="#F5A623" stroke-width="8" fill="none"/><path d="M 55 25 C 65 15, 75 15, 75 25" stroke="#F5A623" stroke-width="8" fill="none"/></svg>` };
            const promoCategories = [ 'Promo Bank & Payment', 'Promo HP & Gadget', 'Promo Laptop & PC', 'Promo TV & Audio', 'Promo Home Appliances', 'Promo Back to School', 'Promo 17 Agustus', 'Other Promotions' ];
            
            const getPromoCategory = (promo) => { const text = (promo.title + ' ' + (promo.details || '')).toLowerCase(); if (text.includes('bank') || text.includes('credit card') || text.includes('cicilan')) return 'Promo Bank & Payment'; if (text.includes('hp') || text.includes('galaxy') || text.includes('tecno') || text.includes('oppo')) return 'Promo HP & Gadget'; if (text.includes('laptop') || text.includes('back to school')) return 'Promo Laptop & PC'; if (text.includes('tv') || text.includes('audio')) return 'Promo TV & Audio'; if (text.includes('ac ') || text.includes('air conditioner')) return 'Promo Home Appliances'; if (text.includes('pahlawan') || text.includes('17 agustus')) return 'Promo 17 Agustus'; return 'Other Promotions'; };
            const getCategoryIcon = (category) => categoryIcons[category] || categoryIcons['Other Promotions'];
            const calculatePromotionSpan = (startDate, endDate) => { const augustStart = new Date('2025-08-01T00:00:00Z'); const augustEnd = new Date('2025-08-31T23:59:59Z'); let promoStart = new Date(startDate), promoEnd = new Date(endDate); promoStart = promoStart < augustStart ? augustStart : promoStart; promoEnd = promoEnd > augustEnd ? augustEnd : promoEnd; if (promoStart > promoEnd) return { startDay: -1, duration: 0 }; const startDay = promoStart.getUTCDate(); const duration = promoEnd.getUTCDate() - startDay + 1; return { startDay, duration }; };
            const createTimeline = () => { const labelContainer = document.getElementById('timeline-labels'); const scrollContainer = document.getElementById('timeline-content-scroll'); if (!labelContainer || !scrollContainer) return; labelContainer.innerHTML = ''; scrollContainer.innerHTML = ''; const competitors = ['Hartono', 'Electronic City', 'Erablue']; const categories = [...promoCategories]; const fixedHeader = document.createElement('div'); fixedHeader.className = 'timeline-label sticky top-0 bg-[#4f46e5] text-white font-bold'; fixedHeader.style.zIndex = 11; fixedHeader.style.height = '41px'; fixedHeader.textContent = 'AUGUST 2025'; labelContainer.appendChild(fixedHeader); const header = document.createElement('div'); header.className = 'timeline-header'; let headerHTML = ''; const today = new Date(); const currentDayOfMonth = today.getDate(), currentMonth = today.getMonth(), currentYear = today.getFullYear(); for (let day = 1; day <= 31; day++) { let specialClass = ''; const dateInLoop = new Date(Date.UTC(2025, 7, day)); const dayOfWeek = dateInLoop.getUTCDay(); if (dayOfWeek === 0 || dayOfWeek === 6) specialClass = 'weekend'; if (day === currentDayOfMonth && currentMonth === 7 && currentYear === 2025) specialClass += ' today'; headerHTML += `<div class="timeline-header-label ${specialClass.trim()}">${day}</div>`; } header.innerHTML = headerHTML; scrollContainer.appendChild(header); competitors.forEach(compName => { const config = competitorConfig[compName]; const competitorLabel = document.createElement('div'); competitorLabel.className = 'timeline-label competitor-header'; competitorLabel.textContent = compName; labelContainer.appendChild(competitorLabel); const competitorRow = document.createElement('div'); competitorRow.className = 'timeline-row'; for (let i = 0; i < 31; i++) { const cell = document.createElement('div'); cell.className = 'timeline-cell'; cell.style.backgroundColor = config.bgColor; competitorRow.appendChild(cell); } scrollContainer.appendChild(competitorRow); categories.forEach(catName => { const promosForCategory = promotions.filter(p => p.competitor === compName && p.category === catName); if (promosForCategory.length > 0) { promosForCategory.forEach((promo, index) => { if (index === 0) { const categoryLabel = document.createElement('div'); categoryLabel.className = 'timeline-label'; categoryLabel.textContent = catName; labelContainer.appendChild(categoryLabel); } else { const spacerLabel = document.createElement('div'); spacerLabel.className = 'timeline-label'; spacerLabel.innerHTML = `&nbsp;`; labelContainer.appendChild(spacerLabel); } const promoRow = document.createElement('div'); promoRow.className = 'timeline-row'; const span = calculatePromotionSpan(promo.startDate, promo.endDate); if (span.duration > 0) { const bar = document.createElement('div'); bar.className = `timeline-bar ${config.colorClass}`; bar.style.left = `${(span.startDay - 1) * 30 + 2}px`; setTimeout(() => { bar.style.width = `${span.duration * 30 - 4}px`; }, 100); bar.textContent = promo.title; bar.dataset.promoId = promo.id; bar.onclick = () => showPromoDetailsModal(promo.id); promoRow.appendChild(bar); } scrollContainer.appendChild(promoRow); }); } }); }); };
            const renderPromotionCards = () => { const container = document.getElementById('promo-cards-container'); if (!container) return; container.innerHTML = ''; const competitors = ['Hartono', 'Electronic City', 'Erablue']; competitors.forEach(compName => { const compPromotions = promotions.filter(p => p.competitor === compName); if (compPromotions.length === 0) return; const card = document.createElement('div'); card.className = 'promo-card'; card.innerHTML = `<div class="promo-card-header ${competitorConfig[compName].colorClass}">${compName} Promotions</div><div class="promo-card-content" id="promo-content-${compName.replace(/\s/g, '')}"></div>`; container.appendChild(card); const contentDiv = document.getElementById(`promo-content-${compName.replace(/\s/g, '')}`); compPromotions.forEach((promo, index) => { const promoItem = document.createElement('div'); promoItem.className = 'promo-item'; promoItem.style.animationDelay = `${index * 50}ms`; promoItem.innerHTML = `<a href="${promo.url || '#'}" target="_blank" rel="noopener noreferrer" title="Kunjungi halaman promosi"><div class="promo-item-icon-container">${promo.iconHTML}</div></a><div class="promo-item-details"><div class="promo-item-title">${promo.title}</div><div class="promo-item-category">${promo.category}</div><p class="promo-item-description">${promo.details}</p><p class="promo-item-description text-xs text-gray-500 mt-2">${promo.startDate} - ${promo.endDate}</p></div><div class="promo-item-actions"><button class="edit-promo-btn" data-promo-id="${promo.id}" title="Edit Promotion"><i class="fa-solid fa-pencil"></i></button><button class="delete-promo-btn" data-promo-id="${promo.id}" title="Delete Promotion"><i class="fa-solid fa-trash-can"></i></button></div>`; contentDiv.appendChild(promoItem); }); }); };
            const rerenderAll = () => { createTimeline(); renderPromotionCards(); updateLastUpdatedText(); };
            const showPromoDetailsModal = (promoId) => { const promo = promotions.find(p => p.id === promoId); if (!promo) return; const modal = document.getElementById('promoModal'); document.getElementById('modal-content').textContent = `[${promo.category}] ${promo.title}\n\nDetails: ${promo.details}\nDuration: ${promo.startDate} to ${promo.endDate}`; const modalActions = document.getElementById('modal-actions'); modalActions.innerHTML = ''; const deleteButton = document.createElement('button'); deleteButton.className = 'px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700'; deleteButton.textContent = 'Delete'; deleteButton.onclick = () => showDeleteConfirmModal(promoId); const closeButton = document.createElement('button'); closeButton.className = 'px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300'; closeButton.textContent = 'Close'; closeButton.onclick = () => closeModal('promoModal'); modalActions.appendChild(deleteButton); modalActions.appendChild(closeButton); openModal('promoModal'); };
            const showDeleteConfirmModal = (promoId) => { const confirmModal = document.getElementById('deleteConfirmModal'); document.getElementById('confirmDeleteBtn').dataset.promoId = promoId; openModal('deleteConfirmModal'); };
            const showEditPromoModal = (promoId) => { const promo = promotions.find(p => p.id === promoId); if (!promo) return; const modal = document.getElementById('editPromoModal'); document.getElementById('editPromoId').value = promo.id; document.getElementById('editCompetitor').value = promo.competitor; document.getElementById('editPromoType').value = promo.category; document.getElementById('editTitle').value = promo.title; document.getElementById('editPromoUrl').value = promo.url || ''; document.getElementById('editStartDate').value = promo.startDate; document.getElementById('editEndDate').value = promo.endDate; document.getElementById('editDetails').value = promo.details; openModal('editPromoModal'); };
            const populatePromoTypeDropdowns = () => { const selects = [document.getElementById('promoType'), document.getElementById('editPromoType')]; selects.forEach(select => { if (!select) return; select.innerHTML = '<option value="">Select a Category</option>'; promoCategories.forEach(category => { const option = document.createElement('option'); option.value = category; option.textContent = category; select.appendChild(option); }); }); };
            const showNotification = (message, colorClass = 'bg-green-500') => { const notification = document.getElementById('notification'); const notificationText = document.getElementById('notification-text'); notificationText.textContent = message; notification.className = `text-white px-4 py-2 rounded-lg shadow-lg notification ${colorClass}`; notification.classList.add('show'); setTimeout(() => notification.classList.remove('show'), 3000); };
            const updateLastUpdatedText = () => { const lastUpdatedElement = document.getElementById('last-updated-text'); const now = new Date(); const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }; lastUpdatedElement.textContent = `Last updated: ${now.toLocaleDateString('en-US', options)}`; };
            const handleAddPromoForm = async (event) => { event.preventDefault(); const form = event.target; const newPromoData = { competitor: form.competitor.value, title: form.title.value, startDate: form.startDate.value, endDate: form.endDate.value, details: form.details.value, url: form.promoUrl.value, category: getPromoCategory({title: form.title.value, details: form.details.value}) }; const { error } = await supabaseClient.from('promotions').insert([newPromoData]); if (error) { showNotification('❌ Failed to add promotion.', 'bg-red-500'); } else { await loadPromotions(); form.reset(); closeModal('addPromoModal'); showNotification('✅ New promotion added successfully!', 'bg-green-500'); } };
            const handleEditPromoForm = async (event) => { event.preventDefault(); const form = event.target; const promoId = parseInt(form.editPromoId.value); const updatedPromoData = { competitor: form.competitor.value, title: form.title.value, url: form.promoUrl.value, startDate: form.startDate.value, endDate: form.endDate.value, details: form.details.value, category: getPromoCategory({title: form.title.value, details: form.details.value}) }; const { error } = await supabaseClient.from('promotions').update(updatedPromoData).eq('id', promoId); if (error) { showNotification('❌ Failed to update promotion.', 'bg-red-500'); } else { await loadPromotions(); closeModal('editPromoModal'); showNotification('✏️ Promotion updated successfully.', 'bg-green-500'); } };
            const deletePromotion = async (promoId) => { const { error } = await supabaseClient.from('promotions').delete().eq('id', promoId); if (error) { showNotification('❌ Failed to delete promotion.', 'bg-red-500'); } else { await loadPromotions(); closeModal('deleteConfirmModal'); closeModal('promoModal'); showNotification('🗑️ Promotion deleted successfully.', 'bg-blue-500'); } };
            
            const openModal = (id) => document.getElementById(id).classList.add('is-open');
            const closeModal = (id) => document.getElementById(id).classList.remove('is-open');

            // --- INITIALIZATION AND EVENT LISTENERS ---
            populatePromoTypeDropdowns();
            document.getElementById('openAddPromoModalBtn').addEventListener('click', () => openModal('addPromoModal'));
            document.getElementById('closeAddModalBtn').addEventListener('click', () => closeModal('addPromoModal'));
            document.getElementById('closeEditModalBtn').addEventListener('click', () => closeModal('editPromoModal'));
            document.getElementById('addPromoForm').addEventListener('submit', handleAddPromoForm);
            document.getElementById('editPromoForm').addEventListener('submit', handleEditPromoForm);
            document.getElementById('cancelDeleteBtn').addEventListener('click', () => closeModal('deleteConfirmModal'));
            document.getElementById('confirmDeleteBtn').addEventListener('click', (e) => { const promoId = parseInt(e.currentTarget.dataset.promoId); deletePromotion(promoId); });
            
            // Event delegation for promo cards
            document.getElementById('promo-cards-container').addEventListener('click', (e) => {
                const editButton = e.target.closest('.edit-promo-btn');
                const deleteButton = e.target.closest('.delete-promo-btn');
                if (editButton) {
                    showEditPromoModal(parseInt(editButton.dataset.promoId));
                }
                if (deleteButton) {
                    showDeleteConfirmModal(parseInt(deleteButton.dataset.promoId));
                }
            });

            async function initializeApp() {
                await addBulkPromotions();
                await loadPromotions();
            }
            initializeApp();
        });
    </script>
</body>
</html>
